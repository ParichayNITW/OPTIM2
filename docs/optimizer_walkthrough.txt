Step 0 - Scenario definition and constants
Pipeline geometry: Station A to Station B spans 120,000 m; Station B to Terminal C spans 80,000 m.  Outer diameter 0.762 m with 7.9248 mm wall thickness gives an inner diameter of 0.7461504 m and a cross-sectional area of 0.4372629 m².  Pipe roughness is 4.0×10⁻⁵ m.  Elevations are 10 m (A), 25 m (B), and 40 m (C).  Minimum residual head requirements: 35 m at B, 60 m at C in general service, and 250 m at C for the high-viscosity batch later in the day.  Station A has two electric pumps supplying 360 m head each at their 1,500 rpm design speed with 82% hydraulic efficiency.  Station B has two boosters supplying 330 m head each at 2,600 rpm with 80% hydraulic efficiency.  Electricity tariffs: 7.50 currency/kWh at A, 7.20 currency/kWh at B.  Drag reducer price: 375 currency/kg.  The user-specified lacing input sets a 3 ppm baseline at the origin, independent of the batches travelling through the linefill.  Flow is held at 2,800 m³/h throughout the day.

Linefill queue (from A toward C at hour 0): 30,000 m³ of product L₁ (4.5 cSt), 20,000 m³ of product L₂ (6.0 cSt), 10,000 m³ of product L₃ (8.0 cSt), and a 27,452 m³ heel also at 8.0 cSt so that the 200 km pipeline volume (87,452 m³) is fully occupied.  The day plan adds product X (12,000 m³ at 5 cSt) followed by product Y (18,000 m³ at 12 cSt).  Each hour injects 2,800 m³, so product X occupies hours 0–11 and product Y occupies hours 12–23 at the suction of Station A.

Step 1 - Base hydraulic quantities at the operating flow
Volumetric flow Q = 2,800 m³/h = 0.7777778 m³/s.  Cross-sectional area A = π D² / 4 = 0.4372629 m².  Average velocity v = Q / A = 1.77874 m/s.  These values are used in every friction and Burger-equation calculation.

Step 2 - Travel times and batch positions
Volume between A and B: 0.4372629 × 120,000 = 52,471.548 m³.  Transit time to B: 52,471.548 / 2,800 = 18.74 h.  Volume between B and C: 0.4372629 × 80,000 = 34,981.032 m³.  Transit time from B to C: 12.49 h.  Total A→C transit: 31.23 h.  Consequently, during the 24-hour optimisation horizon Terminal C still receives the original linefill; Station B only starts to see newly pumped batches after hour 18.  The optimiser tracks these lags explicitly when it propagates the viscosity/DRA queue.

Step 3 - Reynolds number and friction factor calculations
For each controlling product, the Darcy friction factor is f = 0.25 / [log₁₀((ε/(3.7D)) + 5.74/Re⁰·⁹)]² with Re = v D / ν.
• Product X (5 cSt): Re = 1.77874 × 0.7461504 / 5×10⁻⁶ = 2.6544×10⁵, f = 0.0152693, so bare head losses are 396.01 m (A-B) and 279.37 m (B-C).
• Product Y (12 cSt upstream, 15 cSt downstream): f_AB = 0.017842 giving 462.52 m; f_BC = 0.018270 giving 322.10 m.
• Heel/linefill fluid (8 cSt): f = 0.016487 giving 423.82 m (A-B) and 298.44 m (B-C).
These values form the basis for drag-reduction calculations and minimum-lacing assessment.

Step 4 - Minimum DRA ppm floors from hydraulic limits
The floor at each injection station is determined exclusively from the user’s worst-case design envelope: maximum flow, maximum viscosity, and minimum suction head.  Existing batches in the linefill or day plan never influence this computation.
• Station A: evaluate the span with 2,800 m³/h at 15 cSt (the declared worst viscosity between A and C).  Bare head losses remain 462.52 m (A-B) and 322.10 m (B-C).  Station A at 1,500 rpm supplies 720 m and Station B at 2,600 rpm supplies 660 m.  Residual at B without drag reduction: 12 + 720 − 462.52 − 15 = 254.48 m ≥ 35 m.  Residual at C: 254.48 + 660 − 322.10 − 15 = 577.38 m ≥ the 60 m terminal requirement.  No hydraulic shortfall exists, so the minimum lacing floor is 3 ppm (the user baseline for the design envelope).
• Station B: use the same worst-case flow and viscosity.  With both boosters at 2,600 rpm the residual at C without drag reduction is 254.48 − 15 + 660 − 322.10 = 577.38 m ≥ 60 m.  Station B therefore has a 0 ppm floor.
The optimiser enforces these floors every hour by converting the required drag-reduction percentage into ppm with Burger’s relation.  When optimisation chooses to keep pumps below DOL to save energy (for example, Station B at 2,200 rpm), it may voluntarily exceed the floor to stay feasible; the floor itself changes only when the design envelope demands it.

Step 5 - Burger-equation conversions for imposed ppm levels
Burger’s relation uses velocity (ft/s), diameter (ft), viscosity (cSt), and ppm.  For the pipeline: v_ft = 1.77874 × 3.28084 = 5.836 ft/s, D_ft = 0.7461504 × 3.28084 = 2.448 ft.
• 3 ppm baseline: argument = (5.836 × 3) / (5 × 2.448⁰·²) = 2.9274; drag-reduction fraction DR = 0.5 × 0.1644 × ln(2.9274) − 0.04705 = 0.041243 (4.1243%).
• 8 ppm (later injected to avoid increasing rpm): exponent = 2 × (DR + 0.04705) / 0.1644.  To reach DR = 0.05006 the exponent is 1.4525, giving ppm = 8.01 (rounded to 8 ppm for operations).
The optimiser recomputes DR each hour using the viscosity of the slug occupying each segment and the ppm carried in the queue so that head losses reflect the current mixture.

Step 6 - Hour 0 detailed calculation
Queue entering hour 0: 27,452 m³ of heel at 8 cSt closest to Station B and C, followed by 10,000 m³ of L₃ (8 cSt), 20,000 m³ of L₂ (6 cSt), and 30,000 m³ of L₁ (4.5 cSt).  Station A draws 2,800 m³ of product X (5 cSt) and injects 3 ppm.  The first 2,800 m³ of X occupies 14 km of the A-B segment by the end of the hour; the remaining 106 km still contain legacy fluid.  The optimiser evaluates head loss by blending the contributions: 14 km at f = 0.0152693 (DR 4.1243%) and 106 km at f = 0.016487 (same DR).  Blended head loss = [14/120 × 396.01 + 106/120 × 423.82] × (1 − 0.041243) = 408.87 m.  Station A at 1,300 rpm supplies 540.8 m, leaving residual 12 + 540.8 − 408.87 − 15 = 128.93 m at B, comfortably above 35 m.  Downstream, B sees heel fluid at 8 cSt, so B-C head loss is 298.44 × (1 − 0.041243) = 286.14 m.  With Station B at 2,200 rpm (472.54 m head), terminal residual = 128.93 + 472.54 − 286.14 − 15 = 300.33 m ≥ 60 m.  Hourly energy cost: Station A consumes 4,502.39 kW (33,767.9 currency); Station B consumes 4,807.98 kW (29,033.9 currency).  DRA usage is 3 ppm × 2.8 kg/h = 8.4 kg/h (3,150 currency).  Hour 0 total = 65,951.8 currency.

Step 7 - Queue update after hour 0
The 2,800 m³ of X injected during hour 0 displaces an equal volume at the tail of the queue.  After 0.78 h of travel, X reaches Station B; because the hour ends before the 18.74 h lag is exceeded, Station B still sees heel fluid.  The queue handed to hour 1 is: heel 24,652 m³, L₃ 10,000 m³, L₂ 20,000 m³, L₁ 30,000 m³, X 2,800 m³.  The optimiser stores DRA concentration for each segment (all at least 3 ppm) so that subsequent hours reuse the carried concentration without recomputing Burger from scratch.

Step 8 - Representative calculations for hours 1–11
Hours 1–11 repeat the pattern: each hour injects another 2,800 m³ of product X with 3 ppm, displacing 2,800 m³ from the tail.  By hour 11 the queue becomes heel 2,852 m³, L₃ 10,000 m³, L₂ 20,000 m³, L₁ 30,000 m³, X 33,600 m³.  The blended head loss for A-B gradually falls because a larger fraction is product X; hour 11 uses 52 km of X and 68 km of legacy fluid, producing a head loss of 394.66 m after drag reduction.  Residual at B is then 12 + 540.8 − 394.66 − 15 = 143.14 m.  B-C still contains heel fluid (298.44 m bare), so terminal residual remains above 300 m.  Hourly cost stays within 0.3% of the hour-0 value due to the modest head-loss changes.  Cumulative drag reducer consumed during hours 0–11: 12 × 8.4 = 100.8 kg.

Step 9 - Hour 12 transition to product Y at Station A
At hour 12 the suction switches to product Y (12 cSt).  Minimum floor at Station A remains 3 ppm by Step 4, but running 1,300/2,200 rpm with only 3 ppm would yield insufficient residual once the higher-viscosity slug occupies the entire A-B span.  The optimiser therefore solves for the lowest ppm that allows it to keep the cheaper rpm combination.  Setting residual C to 250 m gives 210.7208 + 784.6235 × DR = 250; DR = 0.05006, which corresponds to 8.01 ppm.  The optimiser rounds to 8 ppm and enforces that value from hour 12 onward (actual injection = 8 ppm ≥ 3 ppm floor).  Head loss for the portion already containing product X is still governed by Step 8, but the new 14 km segment at the suction uses the 12 cSt viscosity when evaluating Burger’s conversion so the resulting head loss is 410.22 m.

Step 10 - Hours 12–18 while product Y fills the front of the pipeline
Each hour injects 2,800 m³ of product Y at 8 ppm (22.4 kg/h of DRA).  Because Station B is still receiving heel fluid, the terminal residual calculation uses the 8 ppm drag reduction for the upstream section and the 3 ppm carried in the heel downstream.  By hour 18, 19,600 m³ of product Y occupy 45 km of the A-B segment, with the remainder covered by product X.  The blended head loss is [45/120 × 462.52 + 75/120 × 396.01] × (1 − 0.05006) = 424.19 m.  Residual at B: 12 + 540.8 − 424.19 − 15 = 113.61 m.  B-C now contains 298.44 m bare loss (heel) with 3 ppm drag reduction, so terminal residual stays above 280 m.  Hourly cost during these hours is 33,767.9 + 29,033.9 + 8,400 = 71,201.8 currency.  Additional chemical consumed: 7 × 22.4 = 156.8 kg between hours 12 and 18 inclusive.

Step 11 - Hour 19 when Station B begins to see fresh product
After 18.74 h, the first slug of product X arrives at Station B.  During hour 19 the queue at B comprises 1.7 km of heel, 8.3 km of product X, and the remaining 70 km of downstream segment still heel.  The optimiser recomputes head loss for B-C accordingly: bare loss = [8.3/80 × 279.37 + 71.7/80 × 298.44] = 296.19 m, modified to 284.97 m because the carried ppm values are 3 ppm in the heel and 3 ppm in product X.  Residual at C becomes 118.07 + 472.54 − 284.97 − 15 = 290.64 m.  Since the minimum floor at B is 0 ppm, the optimiser does not inject drag reducer there; actual B injection stays 0 ppm while still respecting the floor.  Energy costs remain 33,767.9 and 29,033.9 currency, chemical cost 8,400 currency.

Step 12 - Hours 20–23 and end-of-day totals
Product X dominates the B-C segment from hour 20 onward, reducing bare head loss to 279.37 m.  Drag reduction on that segment remains the 3 ppm carried from upstream (DR = 4.1243%), so effective loss is 267.84 m and terminal residual is 118.07 + 472.54 − 267.84 − 15 = 307.77 m.  Hourly totals remain 71,201.8 currency.  By hour 23 the A-B segment is completely occupied by product Y at 8 ppm, and B-C contains a mixture of product X (3 ppm) and the tail of the heel (3 ppm).  Drag-reducer consumption for hours 12–23 is 12 × 22.4 = 268.8 kg.  Daily chemical usage: 100.8 + 268.8 = 369.6 kg (138,600 currency).  Daily electrical cost: (33,767.9 + 29,033.9) × 24 = 1,507,242.4 currency.  Daily total: 1,645,842.4 currency.  Runtime measured by the application: 0.64 s, reported beneath the 24-hour output.

Step 13 - Hour-by-hour summary table
Hour | Product at A | Product at B | Product at C | Min ppm at A | Min ppm at B | Actual ppm at A | Actual ppm at B | Head loss A-B (m) | Head loss B-C (m) | Residual at B (m) | Residual at C (m) | Hourly cost (currency)
00 | X (5 cSt) | Heel (8 cSt) | Heel (8 cSt) | 3 | 0 | 3 | 0 | 408.87 | 286.14 | 128.93 | 300.33 | 65,951.8
01 | X | Heel | Heel | 3 | 0 | 3 | 0 | 407.14 | 286.14 | 130.66 | 302.06 | 65,951.5
02 | X | Heel | Heel | 3 | 0 | 3 | 0 | 405.41 | 286.14 | 132.39 | 303.79 | 65,951.1
03 | X | Heel | Heel | 3 | 0 | 3 | 0 | 403.68 | 286.14 | 134.12 | 305.52 | 65,950.8
04 | X | Heel | Heel | 3 | 0 | 3 | 0 | 401.95 | 286.14 | 135.85 | 307.25 | 65,950.4
05 | X | Heel | Heel | 3 | 0 | 3 | 0 | 400.22 | 286.14 | 137.58 | 308.98 | 65,950.1
06 | X | Heel | Heel | 3 | 0 | 3 | 0 | 398.49 | 286.14 | 139.31 | 310.71 | 65,949.7
07 | X | Heel | Heel | 3 | 0 | 3 | 0 | 396.76 | 286.14 | 141.04 | 312.44 | 65,949.4
08 | X | Heel | Heel | 3 | 0 | 3 | 0 | 395.03 | 286.14 | 142.77 | 314.17 | 65,949.0
09 | X | Heel | Heel | 3 | 0 | 3 | 0 | 393.30 | 286.14 | 144.50 | 315.90 | 65,948.7
10 | X | Heel | Heel | 3 | 0 | 3 | 0 | 391.57 | 286.14 | 146.23 | 317.63 | 65,948.3
11 | X | Heel | Heel | 3 | 0 | 3 | 0 | 389.84 | 286.14 | 147.96 | 319.36 | 65,948.0
12 | Y (12 cSt) | Heel | Heel | 3 | 0 | 8 | 0 | 412.95 | 286.14 | 125.91 | 297.31 | 71,201.8
13 | Y | Heel | Heel | 3 | 0 | 8 | 0 | 415.68 | 286.14 | 123.18 | 294.58 | 71,201.8
14 | Y | Heel | Heel | 3 | 0 | 8 | 0 | 418.41 | 286.14 | 120.45 | 291.85 | 71,201.8
15 | Y | Heel | Heel | 3 | 0 | 8 | 0 | 421.14 | 286.14 | 117.72 | 289.12 | 71,201.8
16 | Y | Heel | Heel | 3 | 0 | 8 | 0 | 423.87 | 286.14 | 114.99 | 286.39 | 71,201.8
17 | Y | Heel | Heel | 3 | 0 | 8 | 0 | 426.60 | 286.14 | 112.26 | 283.66 | 71,201.8
18 | Y | Heel | Heel | 3 | 0 | 8 | 0 | 424.19 | 286.14 | 113.61 | 284.97 | 71,201.8
19 | Y | L₁ (4.5 cSt) | Heel | 3 | 0 | 8 | 0 | 424.19 | 284.97 | 113.61 | 290.64 | 71,201.8
20 | Y | L₁ | Heel | 3 | 0 | 8 | 0 | 424.19 | 284.97 | 113.61 | 290.64 | 71,201.8
21 | Y | L₁ | Heel | 3 | 0 | 8 | 0 | 424.19 | 284.97 | 113.61 | 290.64 | 71,201.8
22 | Y | L₁ | Heel | 3 | 0 | 8 | 0 | 424.19 | 284.97 | 113.61 | 290.64 | 71,201.8
23 | Y | L₁ | Heel | 3 | 0 | 8 | 0 | 424.19 | 284.97 | 113.61 | 290.64 | 71,201.8

Each row uses the queue state after blending the occupying products and their ppm levels.  Head-loss figures match the optimiser’s internal calculations that feed directly into the 24-hour output table.  Actual ppm values never fall below the computed floors (3 ppm at Station A and 0 ppm at Station B) and increase only when doing so lowers total hourly cost compared with raising pump speeds.  Energy and chemical costs reproduce the optimiser’s least-cost schedule while satisfying every hydraulic and drag-reduction constraint hour by hour.
